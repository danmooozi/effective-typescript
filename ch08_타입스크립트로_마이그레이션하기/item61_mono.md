# 아이템 61 의존성 관계에 따라 모듈 단위로 전환하기

### 모듈 단위 전환

타입스크립트를 점진적 마이그레이션을 할 때는 모듈 단위로 각개격파하는 것이 이상적입니다. 보통 최하단에서 최상단으로 이루어지는데 순환관계 등을 가질 수 있어서, 타입을 함부로 추가했다가 에러가 날 수 있다. 그렇기 때문에 나의 프로젝트의 모듈보다는 가져와서 사용하는 서드파티 부터 전환하면 좋다.

서드파티 라이브러리들은 보통 @types 를 지원하기 때문에 얘로 다운 받아서 하면 된다.

그리고 보통 최하단 모듈이란 utils 처럼 같은 느낌이라고 생각하면 되고, 얘 부터 마이그레이션 하는게 좋다. 만약 그렇게 안하면 사용하는 쪽에서 사용되는 애들에 타입 유추가 안되서 사용할 수 없다.

### 선언되지 않은 클래스 멤버

자바스크립트는 클래스 멤버 변수를 선언하든 말든이지만, 타스는 명시적으로 선언해야 한다.

몇몇 IDE 는 빠른 수정을 통해서 누락된 멤버를 추론해서 추가한다. 

그래서 하다보면 가끔 충격적으로 변수가 많을 때도 있습니다. 그렇다고 해서 지금 그 코드를 리팩토링 하면 안되고, 다 하고 나서 해야한다. 한 번에 하면 문제가 발생할 여지가 많다.

### 타입이 바뀌는 값

예를 들어 다음 코드는 ts 로 전환하면 문제가 됩니다.

```tsx
const state = {};
state.name = 'New york';
		// ~~~ '{}' 유형에 'name' 속성이 없습니다.
state.capital = 'Albany';
		// ~~~ '{}' 유형에 'capital' 속성이 없습니다.
```

아이템 23에 나왔던거 처럼 한번에 선언하면 해결은 된다.

```tsx
const state = {
		name: 'New york',
		capital: 'Albany'
}
```

이렇게 하면 쉽지만 혹시라도 생성하기 곤란한 경우에는 임시 방편으로 타입 단언을 넣어서 해결하는게 좋다. 

```tsx
interface State {
		name: string;
		capital: string;
}
const state = {} as State;
state.name = 'New york';
state.capital = 'Albany';
```

 큰 그림은 마이그레이션을 다 하고 하는게 맞다.

### 테스트 코드도 타스로

마지막으로 테스트 코드로 전환하는 중간에도 계속에서 문제가 없는지 확인할 수 있기 때문에, 테스트 코드도 미리 타입스크립트로 변경해두면 좋다.

### 요약

- 마이그레이션의 첫 단계는, 서드파티 모듈과 외부 API 호출에 대한 @types 를 교체하는 것 입니다.
- 의존성 관계도의 아래에서부터 위로 올라가며 마이그레이션을 하면 됩니다. 첫 번째 모듈은 보통 유틸리티 모듈입니다. 의존성 관계도를 시각화하여 진행 과정을 추적하는 것이 좋습니다.
- 이상한 설계를 발견하더라도 리팩터링을 하면 안됩니다. 마이그레이션 작업은 타입스크립트 전환에 집중해야 하며, 나중의 리팩터링을 위해 목록을 만들어 두는 것이 좋습니다.
- 타입스크립트로 전환하며 발견하게 되는 일반적인 오류들을 놓치지 않아햐 합니다. 타입 정보를 유지하기 위해 필요에 따라 JSDoc 주석을 활용해야할 수도 있습니다.
